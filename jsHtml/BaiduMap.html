<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		<meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
		<style type="text/css">
			body, html{width: 100%;height: 100%;margin:0;font-family:"微软雅黑";}
			#allmap{height:500px;width:100%;}
			.anchorBL{display:none} //去除百度标志
		</style>
		<script type="text/javascript" src="http://api.map.baidu.com/api?v=2.0&ak=s8f76Hu2oNbq3MkTxpQH1R2CXCEYKPqH"></script>
		<script src="./qwebchannel.js"></script>  
		<script src="http://libs.baidu.com/jquery/1.9.0/jquery.js"></script>
		<title>经纬度定位</title>
	</head>

<body>
	<div style="width:100%;font-size:12px;" id="allmap"></div>
    <div id = "r-result";>
        <div class="optionpanel">
            <label>选择主题</label>
            <select id="stylelist"
    onchange="changeMapStyle(this.value)"></select>
        </div>
    </div>
    <script type="text/javascript"
src="http://developer.baidu.com/map/custom/stylelist.js"></script>
    <script type="text/javascript">
      new QWebChannel(qt.webChannelTransport, function(channel) {
        window.bridge = channel.objects.bridge;
       window.bridge.sigYourName.connect(function(name) { //连接Qt中brideg类的信号并定义执行代码
          alert(name);//function(name)为一个没有函数名的函数。并在此定义
        });
      });

      function showAlert() {
        alert('this is web alert');
      }

      function getWindowWidth() {
        return $(window).width();
      }
	//初始化模板选择的下拉框
	var sel = document.getElementById('stylelist');
	for(var key in mapstyles){
		var style = mapstyles[key];
		var item = new  Option(style.title,key);
		sel.options.add(item);
	}
	// 百度地图API功能
	var map = new BMap.Map("allmap");
    var old_point;
    var new_point = new BMap.Point(104.076513,30.652262);
    var old_marker;
    var new_marker;
	var old_track = [];
    
	map.enableScrollWheelZoom(true);
    
    var scaleControl = new BMap.ScaleControl({anchor:BMAP_ANCHOR_BOTTOM_LEFT});
    scaleControl.setUnit(BMAP_UNIT_IMPERIAL);
    map.addControl(scaleControl);  //添加比例尺
    
    var overviewControl = new BMap.OverviewMapControl({anchor:BMAP_ANCHOR_BOTTOM_RIGHT,isOpen:true});
    map.addControl(overviewControl);
    
    map.addControl(new BMap.MapTypeControl()); //添加地图类型控件
    map.disable3DBuilding();
      
    changeMapStyle('midnight')
	sel.value = 'midnight';
    
    function setLocation(longitude,latitude){
        map.removeOverlay(old_marker);       //删除旧的标注
        
        new_point = new BMap.Point(longitude,latitude); 
        new_marker = new BMap.Marker(new_point);
        map.addOverlay(new_marker);         //添加新的标注
        map.panTo(new_point);
        new_marker.setAnimation(BMAP_ANIMATION_BOUNCE);
        
        old_marker = new_marker;  //旧标注更新
    }
    
    function theCity(){
        var city = new BMap.LocalCity();
        var cityName = city.name;
        return cityName;
    }
    
    function changeMapStyle(style){
		map.setMapStyle({style:style});
		$('#desc').html(mapstyles[style].desc);
	}
	
	function clearTrack()
	{
		for(var i = 0,j = old_track.length; i < j; i++){
			map.removeOverlay(old_track.shift());
		}
	}
	
	function drawTrack(points)
	{
		if(points.length == 0)return
		var trackPoints = []
		for(var i = 0; i < points.length; i++){
			trackPoints.push(new BMap.Point(points[i].lng,points[i].lat));
		}
		map.panTo(trackPoints[0]);
		var polyline=new BMap.Polyline(trackPoints,{
		    strokeColor: "#ff0000",
			strokeWeight: 3,
			setStrokeStyle:"dashed",
			strokeOpacity: 1
		});
		map.addOverlay(polyline);
		old_track.push(polyline);
		
		var size = new BMap.Size(24,34);
		var offset = new BMap.Size(0,-15);
		var imageSize = new BMap.Size(24,34);
		var camera_icon = new BMap.Icon("icon_camera.png",new BMap.Size(36,36),{
			imageSize: new BMap.Size(36,36),
			infoWindowAnchor:new BMap.Size(0, -3)
		});
		var start_icon = new BMap.Icon("icon_start.png",size,{
			imageSize: imageSize,
			infoWindowAnchor:new BMap.Size(0, -3)
		});
		var end_icon = new BMap.Icon("icon_end.png",size,{
			imageSize: imageSize,
			infoWindowAnchor:new BMap.Size(0, -3)
		});
		
		    // 画图标
		for (var i = 0; i < points.length; i++) {
			var icon = null
			var ooffset = offset
			if(i == 0){
				icon = start_icon
			}else if(i == points.length - 1){
				icon = end_icon
			}else{
				icon = camera_icon
				ooffset = new BMap.Size(0,0)
			}
			
			var marker = new BMap.Marker(trackPoints[i], {
				icon: icon,
				offset: ooffset
			}); // 创建标注
			map.addOverlay(marker);
			old_track.push(marker);
		}
	}
	
	window.onload=function(){
		adjustHeight()
	//	setTimeout(()=>{
	//		map.panTo(new_point);
	//	},5000)
	}
	window.onresize=function(){
		map.centerAndZoom(new_point,11);
		adjustHeight()
	}
	function adjustHeight(){
		var labelHeight = document.getElementById("r-result").offsetHeight;
		var mapObj = document.getElementById("allmap");
		var h = document.documentElement.clientHeight || document.body.clientHeight;
		mapObj.style.height = h - labelHeight + "px";
	}
      </script>
</body>
</html>