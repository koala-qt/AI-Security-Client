<!DOCTYPE html>
<html>

<head>
	<meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<title>Hello, World</title>
	<style type="text/css">
		html {
			height: 100%
		}

		body {
			height: 100%;
			margin: 0px;
			padding: 0px
		}

		#container {
			height: 100%
		}
		.BMap_cpyCtrl {
            display: none;
        }
        .anchorBL {
            display: none;
        }
	</style>

	<script type="text/javascript" src="map_load.js"></script>
	<script type="text/javascript" src="TextIconOverlay_min.js"></script>
	<script type="text/javascript" src="MarkerClusterer_min.js"></script>
</head>
<body>
	<div id="container"></div>
	<script type="text/javascript">
		var outputPath = 'tiles/'; //地图瓦片所在的文件夹
		var fromat = ".jpg"; //格式

		/*var tileLayer = new BMap.TileLayer();
		tileLayer.getTilesUrl = function (tileCoord, zoom) {
			var x = tileCoord.x;
			var y = tileCoord.y;
			var url = outputPath + zoom + '/' + x + '/' + y + fromat;
			return url;
		}
		var tileMapType = new BMap.MapType('tileMapType', tileLayer);*/

		var map = new BMap.Map("container")

		// var point1 = new BMap.Point(54.56, 24.34); // 创建点坐标  
		// var point2 = new BMap.Point(54.55, 24.35); // 创建点坐标  
		// var point3 = new BMap.Point(54.53, 24.35); // 创建点坐标  
		map.centerAndZoom(new BMap.Point(54.534919, 24.345037), 18);
		var data_info = [
			[54.534919, 24.345037, "编号：摄像头1", '2018-02-11 21:06'],
			[54.53633, 24.345054, "编号：摄像头2", '2018-02-12 19:06'],
			[54.53173, 24.341547, "编号：摄像头3", '2018-02-13 01:06']
		];
	
		var opts = {
			width: 150, // 信息窗口宽度
			height: 80, // 信息窗口高度
			title: "摄像头详情", // 信息窗口标题
			enableMessage: true //设置允许信息窗发送短息
		};
		var myIcon = new BMap.Icon("images/camera.png", new BMap.Size(32, 32), {
			// 指定定位位置。   
			// 当标注显示在地图上时，其所指向的地理位置距离图标左上    
			// 角各偏移10像素和25像素。您可以看到在本例中该位置即是   
			// 图标中央下端的尖角位置。    
			anchor: new BMap.Size(10, 25),
			// 设置图片偏移。   
			// 当您需要从一幅较大的图片中截取某部分作为标注图标时，您   
			// 需要指定大图的偏移位置，此做法与css sprites技术类似。    
			imageOffset: new BMap.Size() // 设置图片偏移    
		});

		// 创建标注对象并添加到地图   
		// var marker1 = new BMap.Marker(point1, {
		// 	icon: myIcon
		// });

		// for (var i = 0; i < data_info.length; i++) {
		// 	var marker = new BMap.Marker(new BMap.Point(data_info[i][0], data_info[i][1]), {
		// 		icon: myIcon
		// 	});
		// 	// 创建标注
		// 	var content = data_info[i][2];
		// 	map.addOverlay(marker); // 将标注添加到地图中
		// 	var label = new BMap.Label(data_info[i][3], {
		// 		offset: new BMap.Size(-40, 33)
		// 	});
		// 	marker.setLabel(label);
		// 	addClickHandler(content, marker);
		// }
		var markerArray = []
		var points = []
		for (var i = 0; i < 10; i++) {
			var a = new BMap.Point(54.534919+Math.random()*0.1, 24.345037+Math.random()*0.07 )
			var marker = new BMap.Marker(a);
			if(i<10){
				points.push(a)
			}
			// 创建标注
			markerArray.push(marker)
			// map.addOverlay(marker); // 将标注添加到地图中
			
			// marker.setLabel(label);
			// addClickHandler(content, marker);
		}
		var markerClusterer = new BMapLib.MarkerClusterer(map, {markers:markerArray});
		var allOverlay = map.getOverlays()
		
		//根据事件变换图标样式
		var alertIcon = new BMap.Icon("images/alertCamera.png", new BMap.Size(32, 32), {
			// 指定定位位置。   
			// 当标注显示在地图上时，其所指向的地理位置距离图标左上    
			// 角各偏移10像素和25像素。您可以看到在本例中该位置即是   
			// 图标中央下端的尖角位置。    
			anchor: new BMap.Size(10, 25),
			// 设置图片偏移。   
			// 当您需要从一幅较大的图片中截取某部分作为标注图标时，您   
			// 需要指定大图的偏移位置，此做法与css sprites技术类似。    
			imageOffset: new BMap.Size() // 设置图片偏移    
		});
		// allOverlay[1].setIcon(alertIcon)

		function addClickHandler(content, marker) {
			marker.addEventListener("click", function (e) {
				console.log(e)
				openInfo(content, e)
			});
		}

		function openInfo(content, e) {
			var p = e.target;
			var point = new BMap.Point(p.getPosition().lng, p.getPosition().lat);
			var infoWindow = new BMap.InfoWindow(content, opts); // 创建信息窗口对象 
			map.openInfoWindow(infoWindow, point); //开启信息窗口
		}
		// 创建标注    
		// map.addOverlay(marker1); // 初始化地图，设置中心点坐标和地图级别  

		//添加地图类型控件
		map.addControl(new BMap.MapTypeControl({
			mapTypes: [
				BMAP_NORMAL_MAP,

			]
		}));


		function ZoomControl() {
			// 设置默认停靠位置和偏移量  
			this.defaultAnchor = BMAP_ANCHOR_TOP_LEFT;
			this.defaultOffset = new BMap.Size(10, 10);
		}
		// 通过JavaScript的prototype属性继承于BMap.Control   
		ZoomControl.prototype = new BMap.Control();
		ZoomControl.prototype.initialize = function (map) {
			// 创建一个DOM元素   
			var div = document.createElement("div");
			// 添加文字说明    
			div.appendChild(document.createTextNode("轨迹画线"));
			// 设置样式    
			div.style.cursor = "pointer";
			div.style.border = "1px solid gray";
			div.style.backgroundColor = "white";
			// 绑定事件，点击一次放大两级  

			div.onclick = function (e) {
				// map.zoomTo(map.getZoom() + 2);
				console.log()
				
				// for (let index = 0; index < data_info.length; index++) {
				// 	var point = new BMap.Point(data_info[index][0], data_info[index][1]);
				// 	points.push(point)
					
				// }
				
					//画直线
					var sy = new BMap.Symbol(BMap_Symbol_SHAPE_BACKWARD_OPEN_ARROW, {
						scale: 0.6, //图标缩放大小
						strokeColor: '#fff', //设置矢量图标的线填充颜色
						strokeWeight: '2', //设置线宽
					});
					var icons = new BMap.IconSequence(sy, '10', '30');
					var polyline = new BMap.Polyline(points, {
						// strokeColor: "red",
						// strokeWeight: 4,
						// strokeOpacity: 0.9
						// enableEditing: false, //是否启用线编辑，默认为false
						// enableClicking: false, //是否响应点击事件，默认为true
						icons: [icons],
						strokeWeight: '8', //折线的宽度，以像素为单位
						strokeOpacity: 0.8, //折线的透明度，取值范围0 - 1
						strokeColor: "#18a45b" //折线颜色
					})
					map.addOverlay(polyline);
					//画路线

			
				// var walking = new BMap.WalkingRoute(map, {
				// 	renderOptions: {
				// 		map: map
				// 	}
				// });
				// walking.search(new BMap.Point(54.534919, 24.345037), new BMap.Point(54.53633, 24.345054));失效


			}
			// 添加DOM元素到地图中   
			map.getContainer().appendChild(div);
			// 将DOM元素返回 

			return div;
		}
		var myZoomCtrl = new ZoomControl();
		// 添加到地图当中    
		map.addControl(myZoomCtrl);
		map.setCurrentCity("北京"); // 设置地图显示的城市 此项是必须设置的
		map.enableScrollWheelZoom(true); //开启鼠标滚轮缩放
		//单击获取点击的经纬度
		// map.addEventListener("click", function (e) {
		// 	alert(e.point.lng + "," + e.point.lat);
		// });
	</script>
</body>

</html>