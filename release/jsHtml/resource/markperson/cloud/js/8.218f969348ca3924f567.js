webpackJsonp([8],{"8LRT":function(t,i){},ESh3:function(t,i){},TEZM:function(t,i,e){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var s=e("//Fk"),a=e.n(s),o=e("BO1k"),n=e.n(o),r=e("4syG"),c=e("2hMI"),l={name:"unit_manage",components:{separator:r.a},data:function(){return{pictureList:[],unitform:{customerDescription:"",biography:""},createFrom:{pictureClassification:"",pictureDescription:"",vrPics:!1,files:[]},phtotArr:[],createFileNum:0,editFileNum:0,editFrom:{id:"",pictureClassification:"",pictureDescription:"",vrPics:!1,files:[],fileList:[],readyDel:[]},editDialog:!1,createDialog:!1,rules:{pictureClassification:[{required:!0,message:"不能为空"},{min:2,max:12,message:"长度在 2 到 12 个字符"}]},imgdialogVisible:!1,dialogImageUrl:""}},created:function(){this.netAPI=Object(c.a)().get("unit_manage"),this.unitformSubmit()},mounted:function(){this.getPictureList()},methods:{unitformSubmit:function(){var t=this;this.$http.get(this.netAPI.findCustomerInfoById).then(function(i){200==i.body.status&&(t.unitform.biography=i.body.data.biography,t.unitform.customerDescription=i.body.data.customerDescription)},function(i){t.$message({message:"服务错误"+i,type:"warning"})})},editUnitform:function(){var t=this;this.$http.post(this.netAPI.updateCustomerInfo,this.unitform).then(function(i){200==i.body.status&&t.$message({message:t.$t("common.updateSuccess"),type:"success"})},function(i){t.$message({message:"服务错误"+i,type:"warning"})})},getPictureList:function(){var t=this;this.$http.get(this.netAPI.findCustomerClassificationList).then(function(i){if(200==i.body.status){t.pictureList=i.body.data;var e=!0,s=!1,a=void 0;try{for(var o,r=n()(t.pictureList);!(e=(o=r.next()).done);e=!0){var c=o.value;t.$set(c,"imgList",""),t.addPicture(c)}}catch(t){s=!0,a=t}finally{try{!e&&r.return&&r.return()}finally{if(s)throw a}}console.log(t.pictureList)}})},addPicture:function(t){var i=this;this.$http.get(this.netAPI.findClassificationPictureIdList,{params:{ClassificationId:t.id}}).then(function(i){200==i.body.status&&(t.imgList=i.body.data)},function(t){i.$message({message:"服务错误"+t,type:"warning"})})},pictureUpload:function(){},submitForm:function(t){var i=this;this.$refs[t].validate(function(e){if(!e)return i.$message.error("请填写必填信息"),!1;switch(t){case"createExhibition":i.$refs.createFile.submit();break;case"editExhibition":i.editFileNum>0?i.$refs.editFile.submit():i.editExhibition()}})},filesChange:function(t,i){this.createFileNum++},createHandleRemove:function(){this.createFileNum--},editFilesChange:function(){this.editFileNum++},filesRemove:function(t){"success"==t.status?this.editFrom.readyDel.push(t.name):this.editFileNum--,console.log(this.editFrom.readyDel)},createExhibition:function(t){var i=this;if(console.log("上传"),console.log(t.file),this.createFileNum>1)return this.createFrom.files.push(t.file),void this.createFileNum--;this.createFrom.files.push(t.file);var e=new FormData;e.append("pictureDescription",this.createFrom.pictureDescription),e.append("pictureClassification",this.createFrom.pictureClassification),e.append("vrPics",this.createFrom.vrPics);var s=!0,a=!1,o=void 0;try{for(var r,c=n()(this.createFrom.files);!(s=(r=c.next()).done);s=!0){var l=r.value;e.append("file",l)}}catch(t){a=!0,o=t}finally{try{!s&&c.return&&c.return()}finally{if(a)throw o}}console.log(e.get("file")),this.$http.post(this.netAPI.customerClassificationInsert,e).then(function(t){200==t.body.status&&(i.getPictureList(),i.createExhibitionClose())},function(t){i.$message({message:"服务错误"+t,type:"warning"})})},editExhibition:function(t){var i=this,e=!0;this.editFileNum>0&&1==e&&(this.editFrom.files.push(t.file),this.editFileNum--,e=!1);var s={id:this.editFrom.id,pictureClassification:this.editFrom.pictureClassification,pictureDescription:this.editFrom.pictureDescription,vrPics:this.editFrom.vrPics},o=[];this.editFrom.readyDel.forEach(function(t,i){o.push({id:t})}),console.log(o);var r=new a.a(function(t,e){i.$http.post(i.netAPI.updateCustomerClassification,s).then(function(i){200==i.body.status?t():e()})}),c=new a.a(function(t,e){i.$http.post(i.netAPI.deleteClassificationPictureInBatch,o).then(function(i){200==i.body.status?t():e()})});if(0==this.editFrom.files.length)a.a.all([r,c]).then(function(t){i.editDialogClose(),i.getPictureList(),i.$message.success(i.$t("common.updateSuccess"))});else{var l=new FormData,u=!0,d=!1,m=void 0;try{for(var p,f=n()(this.editFrom.files);!(u=(p=f.next()).done);u=!0){var h=p.value;l.append("file",h)}}catch(t){d=!0,m=t}finally{try{!u&&f.return&&f.return()}finally{if(d)throw m}}l.append("classificationId",this.editFrom.id),console.log(l.get("file"));var g=new a.a(function(t,e){i.$http.post(i.netAPI.updateClassificationPicture,l).then(function(i){200==i.body.status?t():e()})});a.a.all([r,c,g]).then(function(t){i.editDialogClose(),i.getPictureList(),i.$message.success(i.$t("common.updateSuccess"))})}},handlePictureCardPreview:function(t){this.dialogImageUrl=t.url,this.imgdialogVisible=!0},handlePictureCardPreview1:function(t){console.log(t)},editFilesChange1:function(t){console.log(t)},createExhibitionClose:function(){this.createFrom={pictureClassification:"",pictureDescription:"",vrPics:!1,files:[]},this.createDialog=!1,this.createFileNum=0,this.$refs.createExhibition.resetFields(),this.$refs.createFile.clearFiles()},showEditDialog:function(t){var i=this;this.editDialog=!0,this.editFrom.id=t.id,this.editFrom.pictureClassification=t.pictureClassification,this.editFrom.pictureDescription=t.pictureDescription,this.editFrom.vrPics=t.vrPics,this.editFrom.fileList=[],this.editFrom.files=[],this.editFrom.readyDel=[],t.imgList.map(function(t){i.editFrom.fileList.push({name:t,url:i.netAPI.findClassificationPictureById+"?id="+t})})},editDialogClose:function(){this.editDialog=!1,this.$refs.editFile.clearFiles()},nulltoForm:function(t,i){for(var e in t)t[e]=void 0;this.$refs[i].resetFields()},remove:function(t){var i=this;this.$confirm("是否删除选中的相册？","删除提示",{distinguishCancelAndClose:!0,confirmButtonText:this.$t("common.delete"),cancelButtonText:this.$t("delete.cancel"),type:"warning"}).then(function(){i.beforeRemoveImgList(t,function(i){i.$http.get(i.netAPI.deleteCustomerClassificationById,{params:{id:t.id}}).then(function(t){200==t.data.status&&(i.$message.success("相册删除成功！"),i.getPictureList())})})}).catch(function(){i.$message({type:"info",message:"已取消操作"})})},beforeRemoveImgList:function(t,i){var e=this,s=[];t.imgList.forEach(function(t,i){s.push({id:t})}),this.$http.post(this.netAPI.deleteClassificationPictureInBatch,s).then(function(t){200==t.data.status&&i(e)})},pictureHandleRemove:function(){}}},u={render:function(){var t=this,i=t.$createElement,e=t._self._c||i;return e("div",{staticClass:"unit_manage-page"},[e("div",{staticClass:"unit_manage-main"},[e("i",{staticClass:"blue"}),t._v(" "),e("span",{staticClass:"title"},[t._v(t._s(t.$t("unitManage.title")))]),t._v(" "),e("div",{staticClass:"main-content"},[e("div",{staticClass:"unit-info"},[e("el-form",{staticClass:"demo-form-inline",attrs:{model:t.unitform,"label-width":"130px"}},[e("p",[e("el-form-item",{attrs:{label:t.$t("unitManage.name")+"："}},[e("el-input",{staticStyle:{width:"260px"},attrs:{maxlength:"10",placeholder:t.$t("placeholder.plsCompanyName")},model:{value:t.unitform.biography,callback:function(i){t.$set(t.unitform,"biography",i)},expression:"unitform.biography"}})],1)],1),t._v(" "),e("p",[e("el-form-item",{attrs:{label:t.$t("unitManage.introduction")+"："}},[e("el-input",{attrs:{type:"textarea",rows:2,maxlength:"1000",placeholder:t.$t("placeholder.plsCompanyDes"),autosize:{minRows:8,maxRows:4}},model:{value:t.unitform.customerDescription,callback:function(i){t.$set(t.unitform,"customerDescription",i)},expression:"unitform.customerDescription"}})],1)],1),t._v(" "),e("p",{staticClass:"submit"},[e("el-form-item",{staticClass:"buttonDiv"},[e("el-button",{attrs:{type:"primary",disabled:!t.$route.meta.modify},on:{click:t.editUnitform}},[t._v(t._s(t.$t("unitManage.save")))])],1)],1)])],1),t._v(" "),e("div",{staticClass:"img-list-box"},[e("div",{staticClass:"img-info-label"},[t._v(t._s(t.$t("unitManage.upload"))+"：")]),t._v(" "),e("div",{staticClass:"img-info-box"},[e("el-row",{attrs:{gutter:12}},[t._l(t.pictureList,function(i,s){return e("el-col",{key:s,staticClass:"card",attrs:{span:3}},[e("el-card",{attrs:{"body-style":{padding:"0px"}}},[e("el-carousel",{attrs:{autoplay:!1,height:"156px","indicator-position":"none"}},t._l(i.imgList,function(i,s){return e("el-carousel-item",{key:s},[e("img",{staticClass:"image",attrs:{src:t.netAPI.findClassificationPictureById+"?id="+i}})])})),t._v(" "),e("div",{staticClass:"card-content"},[e("p",{staticClass:"omit"},[t._v(t._s(i.pictureDescription))]),t._v(" "),e("div",{staticClass:"bottom clearfix"},[e("time",{staticClass:"time"},[t._v(t._s(i.pictureClassification))]),t._v(" "),e("el-button",{staticClass:"button del-btn",staticStyle:{"font-size":"20px"},attrs:{type:"text",icon:"el-icon-delete",disabled:!t.$route.meta.photoRemove},on:{click:function(e){t.remove(i)}}}),t._v(" "),e("el-button",{staticClass:"button",staticStyle:{"font-size":"20px"},attrs:{type:"text",icon:"el-icon-edit",disabled:!t.$route.meta.photoModify},on:{click:function(e){t.showEditDialog(i)}}})],1)])],1)],1)}),t._v(" "),t.$route.meta.photoAdd?e("el-col",{attrs:{span:3}},[e("div",{on:{click:function(i){t.createDialog=!0}}},[e("el-card",{staticClass:"add-icon",attrs:{"body-style":{padding:"0px"}}},[e("i",{staticClass:"el-icon-plus",staticStyle:{color:"#dedede",margin:"auto"}})])],1)]):t._e()],2)],1)]),t._v(" "),e("el-dialog",{attrs:{title:t.$t("unitManage.modify"),visible:t.editDialog,width:"30%","before-close":t.editDialogClose},on:{"update:visible":function(i){t.editDialog=i}}},[e("el-form",{ref:"editExhibition",attrs:{model:t.editFrom,"label-width":"120px",rules:t.rules}},[e("el-form-item",{attrs:{label:t.$t("unitManage.className"),prop:"pictureClassification"}},[e("el-input",{model:{value:t.editFrom.pictureClassification,callback:function(i){t.$set(t.editFrom,"pictureClassification",i)},expression:"editFrom.pictureClassification"}})],1),t._v(" "),e("el-form-item",{attrs:{label:t.$t("unitManage.description")}},[e("el-input",{model:{value:t.editFrom.pictureDescription,callback:function(i){t.$set(t.editFrom,"pictureDescription",i)},expression:"editFrom.pictureDescription"}})],1),t._v(" "),e("el-form-item",{attrs:{label:t.$t("unitManage.pictures"),prop:"file"}},[e("el-upload",{ref:"editFile",attrs:{accept:"image/jpeg,image/jpg,image/bmp,image/png",action:"","list-type":"picture-card","file-list":t.editFrom.fileList,"on-preview":t.handlePictureCardPreview,"auto-upload":!1,"http-request":t.editExhibition,"on-change":t.editFilesChange,"on-remove":t.filesRemove,limit:6}},[e("i",{staticClass:"el-icon-plus"}),t._v(" "),e("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[t._v(t._s(t.$t("unitManage.requirement")))])])],1)],1),t._v(" "),e("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{on:{click:t.editDialogClose}},[t._v(" "+t._s(t.$t("common.cancel")))]),t._v(" "),e("el-button",{attrs:{type:"primary"},on:{click:function(i){t.submitForm("editExhibition")}}},[t._v(t._s(t.$t("common.ok")))])],1)],1),t._v(" "),e("el-dialog",{attrs:{visible:t.imgdialogVisible},on:{"update:visible":function(i){t.imgdialogVisible=i}}},[e("img",{attrs:{width:"100%",src:t.dialogImageUrl,alt:""}})]),t._v(" "),e("el-dialog",{attrs:{title:t.$t("unitManage.pictures"),visible:t.createDialog,width:"30%","before-close":t.createExhibitionClose},on:{"update:visible":function(i){t.createDialog=i}}},[e("el-form",{ref:"createExhibition",attrs:{model:t.createFrom,rules:t.rules,"label-width":"150px"}},[e("el-form-item",{attrs:{label:t.$t("unitManage.className"),prop:"pictureClassification"}},[e("el-input",{model:{value:t.createFrom.pictureClassification,callback:function(i){t.$set(t.createFrom,"pictureClassification",i)},expression:"createFrom.pictureClassification"}})],1),t._v(" "),e("el-form-item",{attrs:{label:t.$t("unitManage.description")}},[e("el-input",{model:{value:t.createFrom.pictureDescription,callback:function(i){t.$set(t.createFrom,"pictureDescription",i)},expression:"createFrom.pictureDescription"}})],1),t._v(" "),e("el-form-item",{attrs:{label:t.$t("unitManage.pictures"),prop:"file"}},[e("el-upload",{ref:"createFile",attrs:{action:"","list-type":"picture-card","auto-upload":!1,"on-preview":t.handlePictureCardPreview,"on-remove":t.createHandleRemove,"http-request":t.createExhibition,"on-change":t.filesChange,limit:6}},[e("i",{staticClass:"el-icon-plus"}),t._v(" "),e("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[t._v(t._s(t.$t("unitManage.requirement")))])])],1)],1),t._v(" "),e("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{on:{click:t.createExhibitionClose}},[t._v(t._s(t.$t("common.cancel")))]),t._v(" "),e("el-button",{attrs:{type:"primary"},on:{click:function(i){t.submitForm("createExhibition")}}},[t._v(t._s(t.$t("common.ok")))])],1)],1)],1)])])},staticRenderFns:[]};var d=e("VU/8")(l,u,!1,function(t){e("o1be"),e("8LRT"),e("g1Bk"),e("ESh3")},"data-v-d022d69c",null);i.default=d.exports},g1Bk:function(t,i){},o1be:function(t,i){}});
//# sourceMappingURL=8.218f969348ca3924f567.js.map