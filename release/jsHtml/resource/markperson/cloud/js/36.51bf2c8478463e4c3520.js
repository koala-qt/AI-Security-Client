webpackJsonp([36],{"B+Nl":function(e,t){},XOrK:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=a("BO1k"),s=a.n(o),n=a("//Fk"),l=a.n(n),i=a("4syG"),r=a("C6kd"),d=a("2hMI"),c={name:"role_manage",components:{separator:i.a},data:function(){return{dialogTitle:"",tableDataLabel:[],netAPI:"",tableData:null,tableBoxLoading:!0,showOBJ:"",dialogVisible:!1,form:{name:"",remark:"",sysRoleOrgDtos:null,sysRoleMenuDtos:null},defaultProps:{children:"children",label:"name"},orgDefaultchecked:[],menusDefaultchecked:[],orgDefaultcheckedList:[],menusDefaultcheckedList:[]}},computed:{},created:function(){this.tableDataLabel=r.a.get("role_manage"),this.netAPI=Object(d.a)().get("role_manage"),this.getData()},methods:{getData:function(){var e=this;this.$http.get(this.netAPI.find).then(function(t){200==t.body.status&&(e.tableBoxLoading=!1,e.tableData=t.body.data)})},createUser:function(e){var t=this,a=new l.a(function(e,a){t.getUserData(t.netAPI.menus,"",function(t,a){e(t)})}),o=new l.a(function(e,a){t.getUserData(t.netAPI.org,"",function(t,a){e(t)})});l.a.all([a,o]).then(function(e){t.dialogTitle=t.$t("roleManage.add"),t.dialogVisible=!0,console.log(e[1]),t.form.sysRoleOrgDtos=[],t.form.sysRoleMenuDtos=t.findeTreeMain(e[0],"1003"),console.log(t.form.sysRoleOrgDtos)})},details:function(e){var t=this;this.orgDefaultchecked=[],this.menusDefaultchecked=[],this.getUserData(this.netAPI.details+e.id,e.id,function(e,a){t.dialogTitle=t.$t("common.details"),a.showOBJ=e,t.dialogVisible=!0,t.form.name=e.name,t.form.remark=e.remark,t.form.sysRoleOrgDtos=[],console.log(e.sysMenus),t.form.sysRoleMenuDtos=t.findeTreeMain(e.sysMenus,"1003",!0)})},editPeople:function(e){var t=this;this.orgDefaultchecked=[],this.menusDefaultchecked=[],this.getUserData(this.netAPI.details+e.id,e.id,function(e,a){t.dialogTitle=t.$t("common.edit"),a.showOBJ=e,t.dialogVisible=!0,t.form.name=e.name,t.form.remark=e.remark,t.form.sysRoleOrgDtos=[],console.log(e.sysMenus),t.form.sysRoleMenuDtos=t.findeTreeMain(e.sysMenus,"1003",!1)})},getUserData:function(e){var t=this,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",o=arguments[2];this.$http.get(e,{params:a}).then(function(e){200==e.body.status&&o(e.body.data,t)})},deleteRow:function(e){var t=this;this.$confirm(this.$t("delete.deleteIt"),this.$t("delete.tips"),{confirmButtonText:this.$t("delete.ok"),cancelButtonText:this.$t("delete.cancel"),type:"warning"}).then(function(){t.$http.post(t.netAPI.delete+e.id,{id:e.id}).then(function(e){200==e.body.status&&(t.$message({type:"success",message:t.$t("delete.success")}),t.getData())})}).catch(function(){t.$message({type:"info",message:t.$t("delete.canceledDeletion")})})},handleClose:function(){this.dialogVisible=!1,this.showOBJ=null,this.form={roleName:"",roleDetails:"",orgs:null,menus:null,name:""},this.$refs.form.resetFields(),this.orgDefaultcheckedList=[],this.menusDefaultcheckedList=[]},submitForm:function(){var e=this,t=this.$refs.org.getCheckedNodes(!1,!0),a=this.$refs.menu.getCheckedNodes(!1,!0),o=!0,n=!1,l=void 0;try{for(var i,r=s()(t);!(o=(i=r.next()).done);o=!0){var d=i.value;this.orgDefaultcheckedList.push({orgId:d.id})}}catch(e){n=!0,l=e}finally{try{!o&&r.return&&r.return()}finally{if(n)throw l}}var c=!0,u=!1,h=void 0;try{for(var f,m=s()(a);!(c=(f=m.next()).done);c=!0){var g=f.value;this.menusDefaultcheckedList.push({menuId:g.id})}}catch(e){u=!0,h=e}finally{try{!c&&m.return&&m.return()}finally{if(u)throw h}}this.$refs.form.validate(function(t){if(!t)return console.log("error submit!!"),!1;switch(e.dialogTitle){case e.$t("roleManage.add"):e.create();break;case e.$t("common.edit"):e.update()}})},create:function(){var e=this;console.log(this.menusDefaultcheckedList),this.$http.post(this.netAPI.save,{name:this.form.name,remark:this.form.remark,sysRoleOrgDtos:this.orgDefaultcheckedList,sysRoleMenuDtos:this.menusDefaultcheckedList}).then(function(t){200==t.body.status?(e.handleClose(),e.getData()):(e.$message.success("创建成功!"),e.handleClose())},function(t){e.handleClose()})},update:function(){var e=this;this.$http.put(this.netAPI.put+this.showOBJ.id,{id:this.showOBJ.id,name:this.form.name,remark:this.form.remark,sysRoleOrgDtos:this.orgDefaultcheckedList,sysRoleMenuDtos:this.menusDefaultcheckedList}).then(function(t){200==t.body.status?(e.handleClose(),e.getData(),e.$message.success("保存成功!")):e.handleClose()},function(t){e.handleClose()})},toTree:function(e,t){for(var a=[],o=void 0,s=0;s<e.length;s++)if(e[s].parentCode==t){var n=e[s];(o=this.toTree(e,e[s].code)).length>0&&(n.children=o),a.push(n)}return a},toArray:function(e,t){for(var a in e)e[a].children?(t.push(e[a]),this.toArray(e[a].children,t)):t.push(e[a])},openDialog:function(){var e=this;this.$nextTick(function(){e.$refs.menu.setCheckedNodes(e.menusDefaultchecked)})},findeTreeMain:function(e,t){var a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=arguments.length>3&&void 0!==arguments[3]&&arguments[3],n=!0,l=!1,i=void 0;try{for(var r,d=s()(e);!(n=(r=d.next()).done);n=!0){var c=r.value;"1001"==t&&(c.roleOrgId?this.orgDefaultchecked.push(c.roleOrgId):c.roleOrgId=null),"1003"==t&&(c.roleMenuId?(console.log(c.name+"xxx"+c.roleMenuId),this.menusDefaultchecked.push(c)):(console.log(c.name+c.roleMenuId),c.roleMenuId=null)),a&&(c.disabled=!0)}}catch(e){l=!0,i=e}finally{try{!n&&d.return&&d.return()}finally{if(l)throw i}}for(var u in e)if(e[u].code==t)return o?(e[u].parentCode="1",e.push({code:"1"}),this.toTree(e,"1")):this.toTree(e,t)},roleOrgCheckChange:function(e,t,a){},roleMenuCheckChange:function(e,t,a){}}},u={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"role_manage"},[a("div",{staticClass:"role-manage-main"},[a("div",{staticClass:"buttonber"},[a("i",{staticClass:"blue"}),e._v(" "),a("span",{staticClass:"title"},[e._v(e._s(e.$t("roleManage.title")))]),e._v(" "),a("el-button",{attrs:{disabled:!e.$route.meta.add},on:{click:e.createUser}},[e._v(e._s(e.$t("roleManage.add")))])],1),e._v(" "),a("div",{ref:"tableBox",staticClass:"table-box"},[a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.tableBoxLoading,expression:"tableBoxLoading"}],ref:"table",attrs:{data:e.tableData,"default-sort":{prop:"id",order:"ascending"},"header-cell-style":{background:"rgba(245,248,252,1)"}}},[a("el-table-column",{attrs:{type:"index",label:e.$t("roleManage.index"),width:"70"}}),e._v(" "),e._l(e.tableDataLabel,function(t,o){return a("el-table-column",{key:o,attrs:{sortable:"",prop:t.property,label:"en"==e.$i18n.locale?t.enName:t.name,"min-width":t.width}})}),e._v(" "),a("el-table-column",{attrs:{label:e.$t("common.operation"),width:"180"},scopedSlots:e._u([{key:"default",fn:function(t){return 1!=t.row.id?[a("el-button",{attrs:{type:"text",size:"small"},on:{click:function(a){e.details(t.row)}}},[e._v("\n                        "+e._s(e.$t("common.details"))+"\n                        ")]),e._v(" "),a("el-button",{staticClass:"del-btn",attrs:{type:"text",size:"small",disabled:!e.$route.meta.modify},on:{click:function(a){e.editPeople(t.row)}}},[e._v("\n                          "+e._s(e.$t("common.edit"))+"\n                        ")]),e._v(" "),a("el-button",{staticClass:"del-btn",attrs:{type:"text",size:"small",disabled:!e.$route.meta.remove},on:{click:function(a){e.deleteRow(t.row)}}},[e._v("\n                          "+e._s(e.$t("common.delete"))+"\n                        ")])]:void 0}}])})],2)],1),e._v(" "),a("el-dialog",{attrs:{title:e.dialogTitle,visible:e.dialogVisible,width:"650px","before-close":e.handleClose},on:{"update:visible":function(t){e.dialogVisible=t},open:e.openDialog}},[a("el-form",{ref:"form",staticStyle:{height:"550px","overflow-x":"hidden"},attrs:{model:e.form,"label-position":"left","label-width":"150px",size:"mini"}},[a("el-form-item",{attrs:{label:e.$t("roleManage.name"),prop:"name",rules:{required:!0,message:e.$t("placeholder.plsPersonName")}}},[a("el-input",{attrs:{disabled:e.dialogTitle==e.$t("common.details")},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1),e._v(" "),a("el-form-item",{attrs:{label:e.$t("roleManage.describe"),prop:"remark"}},[a("el-input",{attrs:{disabled:e.dialogTitle==e.$t("common.details"),clearable:""},model:{value:e.form.remark,callback:function(t){e.$set(e.form,"remark",t)},expression:"form.remark"}})],1),e._v(" "),a("el-form-item",{attrs:{label:e.$t("roleManage.selection"),prop:"remark"}},[a("div",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],staticClass:"tree_org"},[a("el-tree",{ref:"org",attrs:{"default-expand-all":"",data:e.form.sysRoleOrgDtos,"show-checkbox":"","default-checked-keys":e.orgDefaultchecked,"node-key":"roleOrgId",props:e.defaultProps},on:{"check-change":e.roleOrgCheckChange}})],1),e._v(" "),a("div",{staticClass:"tree_menu"},[a("el-tree",{ref:"menu",attrs:{"default-expand-all":"",data:e.form.sysRoleMenuDtos,"default-checked-keys":e.menusDefaultchecked,"show-checkbox":"","node-key":"roleMenuId",props:e.defaultProps},on:{"check-change":e.roleMenuCheckChange}})],1)])],1),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.dialogVisible=!1}}},[e._v(e._s(e.$t("common.cancel")))]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:e.submitForm}},[e._v(e._s(e.$t("common.ok")))])],1)],1)],1)])},staticRenderFns:[]};var h=a("VU/8")(c,u,!1,function(e){a("B+Nl")},"data-v-395c9743",null);t.default=h.exports}});
//# sourceMappingURL=36.51bf2c8478463e4c3520.js.map