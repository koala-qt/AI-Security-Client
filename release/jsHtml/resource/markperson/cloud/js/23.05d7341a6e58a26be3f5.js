webpackJsonp([23],{DxiI:function(e,t){},"H/MP":function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=a("BO1k"),n=a.n(s),i=a("mvHQ"),l=a.n(i),o=a("2hMI"),r=a("uXZL"),p=a.n(r),c=a("lDdF"),u=a.n(c),v={name:"asd",data:function(){return{active:1,title:"导入人员",uploadInfoFile:0,excelOBj:"",netAPI:null,peopleType:[],peopleTypeCurrent:null,tableDataLabel:[],tableData:[],cacheFile:null,errResponse:[],warnResponse:[],buttonLoading:!1,errorDataLabel:[]}},created:function(){this.netAPI=Object(o.a)().get("bulkImport"),this.getPeopleType()},methods:{stepsNext:function(){switch(this.active){case 1:if(!this.uploadInfoFile)return void this.$message.warning("人员信息文件为必要文件!");if(!this.peopleTypeCurrent)return void this.$message.warning("请选择人员类型!");this.$refs.uploadInfo.submit(),this.$refs.uploadImg.submit();break;case 2:this.upload()}},stepsBack:function(){this.active>1&&(this.tableDataLabel=[],this.tableData=[],this.peopleTypeCurrent=null,this.active=1,this.cacheFile=null,this.errResponse=[],this.warnResponse=[],this.buttonLoading=!1,this.errorDataLabel=[])},parseXlsORx:function(e){var t=this,a=e.file,s=new FileReader;s.readAsBinaryString(a),s.onload=function(e){var a=e.target.result,s=p.a.read(a,{type:"binary"});t.excelOBj=p.a.utils.sheet_to_json(s.Sheets[s.SheetNames[0]]),console.log("excel:",t.excelOBj),t.getPeopleAttribute()}},upZip:function(e){this.cacheFile=e.file},uploadInfoChange:function(){this.uploadInfoFile++},uploadInfoRemove:function(){this.uploadInfoFile--},getPeopleType:function(){var e=this;this.$http.get(this.netAPI.findPeopleType).then(function(t){200==t.body.status?e.peopleType=t.body.data:e.$message.warning(l()(t.body.message))},function(t){e.$message.warning(l()(t))})},getPeopleAttribute:function(){var e=this;this.$http.get(this.netAPI.findPeopleAttribute,{params:{categoryNo:this.peopleTypeCurrent}}).then(function(t){if(200==t.body.status){var a=t.body.data;a.push({categoryDescription:"照片",categoryName:"ext_30"}),e.parseTablehead(a)?(e.parseTableData(),e.active++):(e.$message.warning("选中的类型与添加的文件不匹配！"),e.stepsBack())}else e.$message.warning(l()(t.body.message))},function(t){e.$message.warning(l()(t))})},parseTablehead:function(e){var t=this.excelOBj.shift();for(var a in t){var s=!0,i=!1,l=void 0;try{for(var o,r=n()(e);!(s=(o=r.next()).done);s=!0){var p=o.value;p.categoryDescription==t[a]&&this.tableDataLabel.push({name:p.categoryDescription,property:p.categoryName,index:a})}}catch(e){i=!0,l=e}finally{try{!s&&r.return&&r.return()}finally{if(i)throw l}}}return!(this.tableDataLabel.length<e.length)},parseTableData:function(){var e=!0,t=!1,a=void 0;try{for(var s,i=n()(this.excelOBj);!(e=(s=i.next()).done);e=!0){var l=s.value,o={},r=!0,p=!1,c=void 0;try{for(var u,v=n()(this.tableDataLabel);!(r=(u=v.next()).done);r=!0){var d=u.value;o[d.property]=l[d.index]}}catch(e){p=!0,c=e}finally{try{!r&&v.return&&v.return()}finally{if(p)throw c}}this.tableData.push(o)}}catch(e){t=!0,a=e}finally{try{!e&&i.return&&i.return()}finally{if(t)throw a}}},upload:function(){var e=this;this.buttonLoading=!0;var t=new FormData;t.append("personsJson",l()(this.tableData)),t.append("attribute",this.peopleTypeCurrent),this.cacheFile&&t.append("attachmentFile",this.cacheFile),this.$http.post(this.netAPI.importExcel,t).then(function(t){if(200==t.body.status){var a=JSON.parse(t.body.message),s=!0,i=!1,o=void 0;try{for(var r,p=n()(a);!(s=(r=p.next()).done);s=!0){var c=r.value;"warn"==c.errorType?e.warnResponse.push(c):"error"==c.errorType&&e.errResponse.push(c)}}catch(e){i=!0,o=e}finally{try{!s&&p.return&&p.return()}finally{if(i)throw o}}e.tableDataLabel.push({name:"错误原因",property:"error"}),e.tableData=e.errResponse.concat(e.warnResponse),e.buttonLoading=!1,e.active++}else e.$message.warning("上传失败:"+l()(t.body.message))},function(t){e.$message.warning("上传失败:"+l()(t))})},exportExcel:function(){var e=p.a.utils.table_to_book(document.querySelector("#out-table")),t=p.a.write(e,{bookType:"xlsx",bookSST:!0,type:"array"});try{u.a.saveAs(new Blob([t],{type:"application/octet-stream"}),"上传错误.xlsx")}catch(e){"undefined"!=typeof console&&console.log(e,t)}return t}}},d={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"page-content"},[a("div",{staticClass:"page-content-style"},[a("div",{staticClass:"bulkl"},[a("div",{staticClass:"title"},[e._v("\n            导入人员\n          ")]),e._v(" "),a("div",{staticClass:"step"},[a("el-steps",{staticClass:"el-steps--simple",attrs:{active:e.active,simple:""}},[a("el-step",{attrs:{title:"数据导入"}}),e._v(" "),a("el-step",{attrs:{title:"数据浏览"}}),e._v(" "),a("el-step",{attrs:{title:"完成"}})],1)],1),e._v(" "),a("div",{staticClass:"content-boxs"},[1==e.active?a("div",{staticClass:"content-box box1"},[a("div",{staticClass:"up-alert"},[a("p",[e._v("提示：")]),e._v(" "),a("p",[e._v("\n                        第一步：下载导入数据Exlcel模板;\n                          "),a("el-dropdown",[a("span",{staticClass:"el-dropdown-link"},[e._v("\n                              选择下载模板"),a("i",{staticClass:"el-icon-arrow-down el-icon--right"})]),e._v(" "),a("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},e._l(e.peopleType,function(t){return a("el-dropdown-item",{key:t.categoryName},[a("a",{attrs:{href:e.netAPI.exportExcel+"?serviceCode=1010&attribute="+t.categoryNo}},[e._v("【"+e._s(t.categoryName)+"】模板")])])}))],1)],1),e._v(" "),a("p",[e._v("第二步：按模板要求填写导入数据，（标红为必填项）;")]),e._v(" "),a("p",[e._v("第三步：将文件压缩为.zip格式")])]),e._v(" "),a("div",{staticClass:"selectType"},[e._v("\n                      选择导入的类型：\n                      "),a("el-select",{attrs:{clearable:"",placeholder:"请选择"},model:{value:e.peopleTypeCurrent,callback:function(t){e.peopleTypeCurrent=t},expression:"peopleTypeCurrent"}},e._l(e.peopleType,function(e){return a("el-option",{key:e.value,attrs:{label:e.categoryName,value:e.categoryNo}})}))],1),e._v(" "),a("div",{staticClass:"uploadChunk"},[a("div",[a("div",{staticClass:"title"},[e._v("\n                        人员信息文件\n                      ")]),e._v(" "),a("div",{staticClass:"upload-demo"},[a("el-upload",{ref:"uploadInfo",attrs:{action:"",accept:".xls,.xlsx","on-remove":e.uploadInfoRemove,"on-change":e.uploadInfoChange,"http-request":e.parseXlsORx,multiple:!1,limit:1,"auto-upload":!1}},[a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"仅支持：.xls,.xlsx",placement:"right"}},[a("el-button",{attrs:{size:"small"}},[e._v("添加文件")])],1)],1)],1)]),e._v(" "),a("div",[a("div",{staticClass:"title"},[e._v("\n                        人员照片文件\n                      ")]),e._v(" "),a("div",{staticClass:"upload-demo"},[a("el-upload",{ref:"uploadImg",attrs:{action:"","http-request":e.upZip,multiple:!1,accept:".zip",limit:1,"auto-upload":!1}},[a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"照片压缩包 仅支持：.zip",placement:"right"}},[a("el-button",{attrs:{size:"small"}},[e._v("添加文件")])],1)],1)],1)]),e._v(" "),a("div",{directives:[{name:"loading",rawName:"v-loading",value:!0,expression:"true"}],attrs:{"element-loading-text":"暂不支持","element-loading-spinner":"el-icon-warning"}},[a("div",{staticClass:"title"},[e._v("\n                        人员指纹文件\n                      ")]),e._v(" "),a("div",{staticClass:"upload-demo"},[a("el-upload",{ref:"fingerprint",attrs:{action:"",limit:1,"http-request":e.parseXlsORx,multiple:!1,"auto-upload":!1}},[a("el-button",{attrs:{size:"small"}},[e._v("添加文件")])],1)],1)])])]):e._e(),e._v(" "),2==e.active?a("div",{staticClass:"content-box"},[[a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.tableData}},e._l(e.tableDataLabel,function(e){return a("el-table-column",{key:e.name,attrs:{prop:e.property,label:e.name}})}))]],2):e._e(),e._v(" "),3==e.active?a("div",{staticClass:"content-box"},[a("div",[e._v("导入列表：\n                  "),a("label",{staticClass:"succeedResponse"},[e._v("导入成功"+e._s(e.tableData.length-e.errResponse.length)+"条")]),e._v(" "),a("label",{staticClass:"warnResponse"},[e._v("导入警告"+e._s(e.warnResponse.length)+"条")]),e._v(" "),a("label",{staticClass:"errResponse"},[e._v("导入失败"+e._s(e.errResponse.length)+"条")])]),e._v(" "),a("div",[a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.tableData,id:"out-table"}},e._l(e.tableDataLabel,function(e){return a("el-table-column",{key:e.name,attrs:{prop:e.property,label:e.name}})}))],1)]):e._e()]),e._v(" "),a("div",{staticClass:"button"},[1==e.active?a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(t){e.$router.push("/people_manage")}}},[e._v("返回人员管理")]):e._e(),e._v(" "),3!=e.active?a("el-button",{attrs:{type:"primary",size:"mini",loading:e.buttonLoading},on:{click:e.stepsNext}},[e._v(e._s(e.buttonLoading?"上传中":"下一步"))]):e._e(),e._v(" "),3!=e.active&&1!=e.active?a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:e.stepsBack}},[e._v("重新上传")]):e._e(),e._v(" "),3==e.active?a("el-button",{attrs:{size:"mini"},on:{click:e.exportExcel}},[e._v("导出失败名单")]):e._e(),e._v(" "),3==e.active?a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:e.stepsBack}},[e._v("完成")]):e._e()],1)])])])},staticRenderFns:[]};var h=a("VU/8")(v,d,!1,function(e){a("DxiI")},"data-v-c85a9af6",null);t.default=h.exports}});
//# sourceMappingURL=23.05d7341a6e58a26be3f5.js.map