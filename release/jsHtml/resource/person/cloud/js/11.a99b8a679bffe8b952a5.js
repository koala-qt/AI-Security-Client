webpackJsonp([11],{lJUU:function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAABHNCSVQICAgIfAhkiAAAAa1JREFUOI2t1LFu01AUBuD/v5ckAok+AYgORagKMNChCwMvwFiJvkHFUAmhMFiOdOV7vYLUqRn6AnkCBkYGBiSGklA1CIm5WUHIN76HJY5sNa1twZn820ffPfKRTdSUtfY+yT0AdwGcxHH8+br+G3UggMFisTgAoLTWRwD+GQzGmAAgWGtVXXNtQ9v67yDLIU3TJyGEjUoDeSgiR8v4CsC78nOt9SSKootLYJqmj0XkjYh8bznUjtb6dRRF50BpKSGEOySPh8Phxzaac24vz/MtAFUwz/MPWuvIWvsWwO8mGMmOiPzodrsv1zYkSfLCOfe0xXT71tpn5XuVLSul+r1e70tTkOQEwKMrQRG5PRgMfjUFvfdnALavBAGEphgAGGMykrfWguPxWAP40wZcVuXzXYGz2Wyb5Lcij0ajTpIkuw3An865e5dAEemTPC3yfD7vK6U267QQwkREVospv8MH3vtp+QCl1ClqSms9RWnTZbBjjMmKQHIry7KzOtB7PyXZXwdWNhxC4PI/eG0ZYzIRubkapLhwzr0XkU9FFpGHJL/WgQBA8nkcxzsA8BcXbp0aIyvkWAAAAABJRU5ErkJggg=="},suPY:function(e,t){},vK6h:function(e,t){e.exports="data:image/png;base64,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"},wmdL:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=i("mvHQ"),o=i.n(s),a=i("2hMI"),n={data:function(){return{monitorApi:"",form:{eventName:"",description:"",importantEvent:1,alarmEvent:1,eventStatus:1,effTime:[],rules:[]},formRules:{eventName:[{required:!0,message:"事件名称不能为空",trigger:"blur"}],effTime:[{required:!0,message:"生效时间不能为空",trigger:"blur"}],rules:[{required:!0,message:"事件规则不能为空",trigger:"blur"}],description:[{required:!0,message:"事件描述不能为空",trigger:"blur"}],importantEvent:[{required:!0,message:"重大事件不能为空",trigger:"blur"}],alarmEvent:[{required:!0,message:"告警事件不能为空",trigger:"blur"}],eventStatus:[{required:!0,message:"事件状态不能为空",trigger:"blur"}]},name:"新增自定义事件",title:"新增事件规则",dialogVisible:!1,eventApi:"",eventform:{deviceId:"",name:"",bounds:"",base64:""},diviceOptions:[],deviceLoading:!1,context:"",areas:[],lineToPois:[],canvasSize:{},listenRectPoi:[],isInCircle:!1,boundPic:"",dialogRules:{name:[{required:!0,message:"活动名称不能为空",trigger:"blur"}],deviceId:[{required:!0,message:"设备选项不能为空",trigger:"blur"}]}}},methods:{confirm:function(e){var t=this;this.$refs[e].validate(function(e){if(e){var i=JSON.parse(o()(t.form));i.startTime=i.effTime[0],i.finishTime=i.effTime[1],delete i.effTime,t.$route.query.id?(i.id=t.$route.query.id,t.$http.post(t.eventApi.modify,i).then(function(e){})):(console.log(i),t.$http.post(t.eventApi.insert,i).then(function(e){}))}})},diviceChange:function(e){var t=this,i=this;console.log(this.diviceOptions),this.diviceOptions.forEach(function(i){i.id===e&&(t.eventform.deviceName=i.groupName)}),this.clearHb(),this.initCanvas(),this.$http.get(this.eventApi.getImg,{params:{deviceId:9}}).then(function(e){var s=new Image;s.setAttribute("crossorigin","anonymous"),s.onload=function(){var e=i.context.createPattern(this,"repeat");i.context.fillStyle=e,i.context.fillRect(0,0,660,380)},console.log(e.data.data),s.src="http://"+e.data.data,t.eventform.base64="http://192.168.2.240:32377/api/v1/get_picture"})},resetForm:function(e){console.log(e),this.$refs[e].resetFields()},clearHb:function(e){this.context&&this.context.clearRect(0,0,this.canvasSize.w,this.canvasSize.h),this.lineToPois=[],this.diviceOptions=[],this.listenRectPoi=[],this.isInCircle=!1},initCanvas:function(){var e=document.getElementById("canvas");e.width=this.$refs.canvas.clientWidth,e.height=this.$refs.canvas.clientHeight,this.canvasSize={w:e.width,h:e.height},this.context=e.getContext("2d"),this.context.strokeStyle="red",e.addEventListener("click",this.doClickCanvas,!1),e.addEventListener("mousemove",this.doMousemove,!1)},doMousemove:function(e){this.listenRectPoi.length>0&&(this.context.fillStyle="white",this.context.fill(),this.isInCircle=!1,e.layerX<this.listenRectPoi[2].x&&e.layerX>this.listenRectPoi[0].x&&e.layerY>this.listenRectPoi[0].y&&e.layerY<this.listenRectPoi[1].y&&this.lineToPois.length>0&&(this.strokeCircle(this.lineToPois[0].x,this.lineToPois[0].y),this.isInCircle=!0,this.context.fillStyle="red",this.context.fill()))},doClickCanvas:function(e){if(this.isInCircle)this.autoClose();else{if(0===this.lineToPois.length){var t=[{x:e.layerX-3,y:e.layerY-3},{x:e.layerX-3,y:e.layerY+3},{x:e.layerX+3,y:e.layerY-3}];this.listenRectPoi=t}this.lineToPois.push({x:e.layerX,y:e.layerY}),this.drawLine()}},autoClose:function(){this.lineToPois.push(this.lineToPois[0]),this.drawLine(),this.areas.push(this.lineToPois),this.lineToPois=[]},drawLine:function(){var e=this;this.lineToPois.length>1&&(this.lineToPois.forEach(function(t,i){i===e.lineToPois.length-2?(e.context.beginPath(),e.context.moveTo(t.x,t.y)):i===e.lineToPois.length-1&&e.context.lineTo(t.x,t.y)}),this.context.stroke())},strokeCircle:function(e,t){this.context.beginPath(),this.context.fillStyle="red",this.context.arc(e,t,3,0,2*Math.PI),this.context.stroke()},handleClose:function(e){this.resetForm("eventForm"),this.eventform={deviceId:"",name:"",bounds:"",base64:""},e()},showDialog:function(){this.dialogVisible=!0},remoteMethod:function(e){console.log(e),this.queryDivice(e)},queryDivice:function(e){var t=this,i={groupName:e};this.deviceLoading=!0,this.$http.get(this.monitorApi.deviceManage.findGroup,{params:i}).then(function(e){200==e.body.status&&(t.deviceLoading=!1,t.diviceOptions=e.body.data)})},changeBase:function(){return document.getElementById("canvas").toDataURL("image/png",1)},addRule:function(e){var t=this;this.$refs[e].validate(function(e){if(!e)return!1;var i="";t.areas.forEach(function(e){var t="";e.forEach(function(i,s){t=t+((1920*i.x/660).toFixed(2)+"/")+(1080*i.y/380).toFixed(2)+(e.length-1===s?"":",")}),i=""+i+t+";"}),console.log(i),t.eventform.bounds=i,t.$route.query.id&&(t.eventform.eventId=t.$route.query.id),t.eventform.base64=t.changeBase();var s=JSON.parse(o()(t.eventform));t.eventform.id?t.form.rules.forEach(function(e,i){console.log(e),e.id===t.eventform.id&&(t.form.rules[i]=t.eventform)}):t.form.rules.push(s),console.log(t.form.rules),t.dialogVisible=!1,t.resetForm("eventForm")})},delRule:function(e){this.form.rules[e].hasOwnProperty("id")&&(this.form.hasOwnProperty("ruleIds")?this.form.ruleIds.push(this.form.rules[e].id):(this.form.ruleIds=[],this.form.ruleIds.push(this.form.rules[e].id))),this.form.rules.splice(e,1)},editRule:function(e){var t=this.form.rules[e];this.dialogVisible=!0,this.eventform=JSON.parse(o()(t)),this.title=t.deviceName+"事件规则"}},watch:{dialogVisible:function(e){this.clearHb()},form:{handler:function(e,t){},deep:!0}},created:function(){var e=this;this.monitorApi=Object(a.a)().get("monitorSystem"),this.eventApi=Object(a.a)().get("event_manage"),this.$route.query.id&&this.$http.get(this.eventApi.detail,{params:{id:this.$route.query.id}}).then(function(t){var i=JSON.parse(o()(t.data.data));i.effTime=[i.startTime,i.finishTime],console.log(i),e.form=i})}},r={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"add-event-manage"},[s("div",{staticClass:"title"},[e._v("新建自定义事件")]),e._v(" "),s("div",{staticClass:"record-content"},[s("el-form",{ref:"form",attrs:{model:e.form,rules:e.formRules,"label-width":"210px"}},[s("el-form-item",{attrs:{label:"事件名称:",prop:"eventName"}},[s("el-input",{staticStyle:{width:"260px"},model:{value:e.form.eventName,callback:function(t){e.$set(e.form,"eventName",t)},expression:"form.eventName"}})],1),e._v(" "),s("el-form-item",{attrs:{label:"是否重大事件:",prop:"importantEvent"}},[s("el-select",{staticClass:"sel",attrs:{clearable:""},model:{value:e.form.importantEvent,callback:function(t){e.$set(e.form,"importantEvent",t)},expression:"form.importantEvent"}},[s("el-option",{key:0,attrs:{label:"是",value:1}}),e._v(" "),s("el-option",{key:1,attrs:{label:"否",value:0}})],1)],1),e._v(" "),s("el-form-item",{attrs:{label:"是否告警事件:",prop:"alarmEvent"}},[s("el-select",{staticClass:"sel",attrs:{clearable:""},model:{value:e.form.alarmEvent,callback:function(t){e.$set(e.form,"alarmEvent",t)},expression:"form.alarmEvent"}},[s("el-option",{key:0,attrs:{label:"是",value:1}}),e._v(" "),s("el-option",{key:1,attrs:{label:"否",value:0}})],1)],1),e._v(" "),s("el-form-item",{attrs:{label:"事件状态:",prop:"eventStatus"}},[s("el-select",{staticClass:"sel",attrs:{clearable:""},model:{value:e.form.eventStatus,callback:function(t){e.$set(e.form,"eventStatus",t)},expression:"form.eventStatus"}},[s("el-option",{key:1,attrs:{label:"开启",value:1}}),e._v(" "),s("el-option",{key:2,attrs:{label:"关闭",value:0}})],1)],1),e._v(" "),s("el-form-item",{attrs:{label:"事件描述:",prop:"description"}},[s("el-input",{attrs:{type:"textarea",resize:"none",rows:7,placeholder:"请输入事件描述"},model:{value:e.form.description,callback:function(t){e.$set(e.form,"description",t)},expression:"form.description"}})],1),e._v(" "),s("el-form-item",{attrs:{label:"生效时间",prop:"effTime"}},[s("el-date-picker",{attrs:{format:"yyyy-MM-dd HH:mm:ss","value-format":"yyyy-MM-dd HH:mm:ss",type:"datetimerange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期"},model:{value:e.form.effTime,callback:function(t){e.$set(e.form,"effTime",t)},expression:"form.effTime"}})],1),e._v(" "),s("el-form-item",{attrs:{label:"事件规则设置:",prop:"rules"}},[s("div",{staticClass:"event-add"},[s("el-row",[e._l(e.form.rules,function(t,i){return s("el-col",{key:i,staticClass:"show-add",attrs:{span:8}},[s("div",{staticClass:"show-img"},[s("img",{attrs:{src:t.base64}})]),e._v(" "),s("div",{staticClass:"show-tro"},[s("div",[e._v("设备:"+e._s(t.deviceName))]),e._v(" "),s("div",[e._v("区域名:"+e._s(t.name))]),e._v(" "),s("div",{staticClass:"fix"},[s("i",{staticClass:"el-icon-edit",on:{click:function(t){e.editRule(i)}}}),e._v(" "),s("i",{staticClass:"el-icon-delete",on:{click:function(t){e.delRule(i)}}})])])])}),e._v(" "),s("el-col",{staticClass:"show-add",attrs:{span:8}},[s("div",{staticClass:"img-add"},[s("i",{staticClass:"el-icon-circle-plus-outline",on:{click:e.showDialog}}),e._v(" "),s("div",{staticClass:"tro"},[e._v("新增事件规则")])])])],2)],1)]),e._v(" "),s("el-form-item",[s("el-button",{attrs:{type:"primary"},on:{click:function(t){e.confirm("form")}}},[e._v("确定")])],1)],1)],1),e._v(" "),s("el-dialog",{attrs:{title:e.title,visible:e.dialogVisible,width:"800px","before-close":e.handleClose},on:{"update:visible":function(t){e.dialogVisible=t}}},[s("el-form",{ref:"eventForm",staticClass:"event-form",attrs:{rules:e.dialogRules,model:e.eventform,"label-width":"100px"}},[s("el-form-item",{attrs:{label:"设备:",prop:"deviceId"}},[e.eventform.id?s("div",[e._v(e._s(e.eventform.deviceName))]):s("el-select",{attrs:{filterable:"",remote:"","reserve-keyword":"",placeholder:"请搜索关键词","remote-method":e.remoteMethod,loading:e.deviceLoading},on:{change:function(t){e.diviceChange(t)}},model:{value:e.eventform.deviceId,callback:function(t){e.$set(e.eventform,"deviceId",t)},expression:"eventform.deviceId"}},e._l(e.diviceOptions,function(e){return s("el-option",{key:e.id,attrs:{label:e.groupName,value:e.id}})}))],1),e._v(" "),s("el-form-item",{attrs:{label:"区域名称:",prop:"name"}},[s("el-input",{staticStyle:{width:"260px"},attrs:{placeholder:"请输入区域名称"},model:{value:e.eventform.name,callback:function(t){e.$set(e.eventform,"name",t)},expression:"eventform.name"}})],1),e._v(" "),s("el-form-item",{attrs:{label:"监控画面:",prop:"bounds"}},[s("div",{ref:"drawBox",staticClass:"draw-box"},[s("canvas",{ref:"canvas",staticClass:"canvas",attrs:{id:"canvas"}}),e._v(" "),""!==e.eventform.base64?s("img",{staticClass:"latu",attrs:{src:e.eventform.base64}}):e._e(),e._v(" "),""===e.eventform.base64?s("img",{staticClass:"mr",attrs:{src:i("vK6h")},on:{click:e.clearHb}}):e._e(),e._v(" "),s("div",{staticClass:"fix"},[s("img",{attrs:{src:i("lJUU")},on:{click:function(t){e.clearHb("notClearPic")}}})])])])],1),e._v(" "),s("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{on:{click:function(t){e.dialogVisible=!1}}},[e._v("取 消")]),e._v(" "),s("el-button",{attrs:{type:"primary"},on:{click:function(t){e.addRule("eventForm")}}},[e._v("确 定")])],1)],1)],1)},staticRenderFns:[]};var l=i("VU/8")(n,r,!1,function(e){i("suPY")},null,null);t.default=l.exports}});
//# sourceMappingURL=11.a99b8a679bffe8b952a5.js.map