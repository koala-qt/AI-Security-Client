webpackJsonp([29],{E7oe:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=a("BO1k"),n=a.n(r),i=a("4syG"),o=a("C6kd"),l=a("2hMI"),s={name:"organizational_manage",components:{separator:i.a},data:function(){var e=this,t=function(t,a,r){var n=!1;for(var i in e.listDate)e.listDate[i].name==a&&(n=!0);n?r():r(new Error("不存在【"+a+"】这个父级!"))};return{currentNode:"gen",treeData:[],defaultProps:{children:"children",label:"name"},listDate:[1,2,3,4],filterText:"",multipleSelection:[],tableDataLabel:"",netAPI:"",tableData:[],editDialogVisible:!1,createDialogVisible:!1,createForm:{parentName:"",name:"",remark:""},createFormRules:{parentName:[{required:!0,message:"请输入组织名称",trigger:"blur"},{min:2,max:20,message:"长度在 2 到 20 个字符",trigger:"blur"},{validator:t,trigger:"blur"}],name:[{required:!0,message:"请输入组织名称",trigger:"blur"},{min:2,max:20,message:"长度在 2 到 20 个字符",trigger:"blur"}]},editForm:{id:"",code:"",parentName:"",name:"",remark:"",orderNum:"",gmtCreate:""},editFormRules:{parentName:[{required:!0,message:"请输入组织名称",trigger:"blur"},{min:2,max:20,message:"长度在 2 到 20 个字符",trigger:"blur"},{validator:t,trigger:"blur"}],name:[{required:!0,message:"请输入组织名称",trigger:"blur"},{min:2,max:20,message:"长度在 2 到 20 个字符",trigger:"blur"}]}}},created:function(){this.tableDataLabel=o.a.get("organizational_manage"),this.netAPI=Object(l.a)().get("organizational_manage"),this.getData()},methods:{nulltoForm:function(e,t){for(var a in e)e[a]="";this.$refs[t].resetFields()},filterNode:function(e,t){return!e||-1!==t.name.indexOf(e)},handleDragStart:function(e,t){console.log("drag start",e)},handleDragEnter:function(e,t,a){console.log("tree drag enter: ",t.name)},handleDragLeave:function(e,t,a){console.log("tree drag leave: ",t.name)},handleDragOver:function(e,t,a){console.log("tree drag over: ",t.name)},handleDragEnd:function(e,t,a,r){console.log("tree drag end: ",t&&t.name,a)},handleDrop:function(e,t,a,r){console.log("tree drop: ",t.name,a)},allowDrop:function(e,t,a){return!0},allowDrag:function(e){return!0},handleSelectionChange:function(e){e.length?this.multipleSelection=e:this.multipleSelection=null},createDialogFun:function(){this.nulltoForm(this.createForm,"createForm"),this.createDialogVisible=!1},editDialogFun:function(){this.nulltoForm(this.editForm,"editForm"),this.editDialogVisible=!1},edit:function(e){for(var t in this.editDialogVisible=!0,this.editForm)this.editForm[t]=e[t]},getData:function(){var e=this;this.$http.get(this.netAPI.find).then(function(t){if(200==t.body.status){var a=t.body.data;e.listDate=a,e.getParentName(a),a[0].children=e.toTree(a,a[0].code),e.treeData=[a[0]],e.tableData=[a[0]],e.count(e.treeData[0])}})},submitForm:function(e){var t=this;this.$refs[e].validate(function(a){if(!a)return t.$message.error("请填写必填信息"),!1;switch(e){case"createForm":t.createFormFun();break;case"editForm":t.editFormFun()}})},editFormFun:function(){var e=this;for(var t in this.listDate)this.listDate[t].name==this.editForm.parentName&&(this.editForm.parentCode=this.listDate[t].code);var a={code:this.editForm.code,name:this.editForm.name,parentCode:this.editForm.parentCode,remark:this.editForm.remark,orderNum:this.editForm.orderNum,gmtCreate:this.editForm.gmtCreate};this.$http.put(this.netAPI.put+this.editForm.id,a).then(function(t){200==t.body.status&&(e.getData(),e.$message({message:"修改成功",type:"success"}),e.editDialogFun())})},createFormFun:function(){var e=this;for(var t in this.listDate)this.listDate[t].name==this.createForm.parentName&&(this.createForm.parentCode=this.listDate[t].code);var a={name:this.createForm.name,parentCode:this.createForm.parentCode,remark:this.createForm.remark};this.$http.post(this.netAPI.add,a).then(function(t){200==t.body.status&&(e.getData(),e.$message({message:"创建成功",type:"success"}),e.createDialogFun())})},getParentName:function(e){var t=this,a=function(e){t.$http.get(t.netAPI.findParentName+e.parentCode).then(function(t){if(200==t.body.status)try{e.parentName=t.body.data.name}catch(e){}})},r=!0,i=!1,o=void 0;try{for(var l,s=n()(e);!(r=(l=s.next()).done);r=!0){a(l.value)}}catch(e){i=!0,o=e}finally{try{!r&&s.return&&s.return()}finally{if(i)throw o}}},nodeClick:function(e,t){this.currentNode=e.name,this.tableData=[];try{t.data.children.length>0&&(this.toArray(t.data.children),this.tableData.push(t.data))}catch(e){this.tableData=[t.data]}},toTree:function(e,t){for(var a=[],r=void 0,n=0;n<e.length;n++)if(e[n].parentCode==t){var i=e[n];(r=this.toTree(e,e[n].code)).length>0&&(i.children=r),a.push(i)}return a},toArray:function(e){var t=!0,a=!1,r=void 0;try{for(var i,o=n()(e);!(t=(i=o.next()).done);t=!0){var l=i.value;l.children?(this.tableData.push(l),this.toArray(l.children)):this.tableData.push(l)}}catch(e){a=!0,r=e}finally{try{!t&&o.return&&o.return()}finally{if(a)throw r}}},count:function(e){if(e.children){for(var t=0,a=0;a<e.children.length;a++)t+=this.count(e.children[a]);return t++,e.colspan=t,t}return e.colspan=1,1},remove:function(e){var t=this,a=[];if(e){if("[object Array]"==Object.prototype.toString.call(e))for(var r in e)a.push(e[r].id);else a.push(e.id);this.$confirm("确定要删除选中的行?","删除提示",{distinguishCancelAndClose:!0,confirmButtonText:"删除",cancelButtonText:"不删除"}).then(function(){var e=!0,r=!1,i=void 0;try{for(var o,l=n()(a);!(e=(o=l.next()).done);e=!0){var s=o.value;t.$http.delete(t.netAPI.delete+s).then(function(e){200==e.data.status&&(t.getData(),t.tableData=[])})}}catch(e){r=!0,i=e}finally{try{!e&&l.return&&l.return()}finally{if(r)throw i}}})}else this.$message({message:"请选中要删除的行",type:"warning"})}},watch:{filterText:function(e){this.$refs.tree.filter(e)},currentNode:function(e){this.createForm.parentName=e,this.editForm.parentName=e}}},d={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"organizational-manage"},[a("separator"),e._v(" "),a("div",{staticClass:"content"},[a("div",{staticClass:"tree"},[a("el-input",{attrs:{placeholder:"输入关键字进行过滤"},model:{value:e.filterText,callback:function(t){e.filterText=t},expression:"filterText"}}),e._v(" "),a("el-tree",{ref:"tree",attrs:{data:e.treeData,"node-key":"id","filter-node-method":e.filterNode,"default-expanded-keys":[2,3],"default-checked-keys":[5],props:e.defaultProps,"default-expand-all":"",draggable:"","allow-drop":e.allowDrop,"allow-drag":e.allowDrag},on:{"node-drag-start":e.handleDragStart,"node-drag-enter":e.handleDragEnter,"node-drag-leave":e.handleDragLeave,"node-drag-over":e.handleDragOver,"node-drag-end":e.handleDragEnd,"node-drop":e.handleDrop,"node-click":e.nodeClick},scopedSlots:e._u([{key:"default",fn:function(t){t.node;var r=t.data;return a("span",{staticClass:"custom-tree-node"},[a("span",[e._v(e._s(r.name))]),e._v(" "),a("span",[e._v(e._s(r.colspan-1?"("+(r.colspan-1)+")":""))])])}}])})],1),e._v(" "),a("div",{staticClass:"table"},[a("div",{staticClass:"util"},[a("el-button",{attrs:{type:"primary",disabled:!e.$route.meta.add},on:{click:function(t){e.createDialogVisible=!0}}},[e._v("创建新组织")]),e._v(" "),a("el-button",{attrs:{type:"danger",disabled:!e.$route.meta.remove},on:{click:function(t){e.remove(e.multipleSelection)}}},[e._v("批量删除")])],1),e._v(" "),a("div",{ref:"tableBox",staticClass:"table-box"},[[a("el-table",{ref:"table",staticStyle:{width:"100%"},attrs:{data:e.tableData,"default-sort":{prop:"id",order:"ascending"}},on:{"selection-change":e.handleSelectionChange}},[a("el-table-column",{attrs:{fixed:"",type:"selection",width:"55"}}),e._v(" "),e._l(e.tableDataLabel,function(e,t){return["index"==e.type?a("el-table-column",{key:t,attrs:{type:"index",width:"50",label:e.name}}):a("el-table-column",{key:t,attrs:{sortable:"",prop:e.property,label:e.name,"min-width":e.width}})]}),e._v(" "),a("el-table-column",{attrs:{fixed:"right",label:"操作",width:"150"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"text",size:"small",disabled:!e.$route.meta.modify},nativeOn:{click:function(a){a.preventDefault(),e.edit(t.row)}}},[e._v("\n                            编辑\n                            ")]),e._v(" "),a("el-button",{staticClass:"del-btn",attrs:{type:"text",size:"small",disabled:!e.$route.meta.remove},nativeOn:{click:function(a){a.preventDefault(),e.remove(t.row)}}},[e._v("\n                            移除\n                            ")])]}}])})],2)]],2)])]),e._v(" "),a("el-dialog",{attrs:{title:"新增",visible:e.createDialogVisible,width:"30%","before-close":e.createDialogFun},on:{"update:visible":function(t){e.createDialogVisible=t}}},[a("el-form",{ref:"createForm",staticClass:"demo-ruleForm",attrs:{model:e.createForm,"status-icon":"",rules:e.createFormRules,"label-width":"100px"}},[a("el-form-item",{attrs:{label:"上级组织",prop:"parentName"}},[a("el-input",{attrs:{"auto-complete":"off"},model:{value:e.createForm.parentName,callback:function(t){e.$set(e.createForm,"parentName",t)},expression:"createForm.parentName"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"组织名称",prop:"name"}},[a("el-input",{attrs:{"auto-complete":"off"},model:{value:e.createForm.name,callback:function(t){e.$set(e.createForm,"name",t)},expression:"createForm.name"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"组织描述",prop:"remark"}},[a("el-input",{model:{value:e.createForm.remark,callback:function(t){e.$set(e.createForm,"remark",e._n(t))},expression:"createForm.remark"}})],1)],1),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(){e.createDialogVisible=!1,e.nulltoForm(e.createForm,"createForm")}}},[e._v("取 消")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:function(t){e.submitForm("createForm")}}},[e._v("确 定")])],1)],1),e._v(" "),a("el-dialog",{attrs:{title:"修改",visible:e.editDialogVisible,width:"30%","before-close":e.editDialogFun},on:{"update:visible":function(t){e.editDialogVisible=t}}},[a("el-form",{ref:"editForm",staticClass:"demo-ruleForm",attrs:{model:e.editForm,"status-icon":"",rules:e.editFormRules,"label-width":"100px"}},["1001"!=e.editForm.code?a("el-form-item",{attrs:{label:"上级组织",prop:"parentName"}},[a("el-input",{attrs:{"auto-complete":"off"},model:{value:e.editForm.parentName,callback:function(t){e.$set(e.editForm,"parentName",t)},expression:"editForm.parentName"}})],1):e._e(),e._v(" "),a("el-form-item",{attrs:{label:"组织名称",prop:"name"}},[a("el-input",{attrs:{"auto-complete":"off"},model:{value:e.editForm.name,callback:function(t){e.$set(e.editForm,"name",t)},expression:"editForm.name"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"组织描述",prop:"remark"}},[a("el-input",{model:{value:e.editForm.remark,callback:function(t){e.$set(e.editForm,"remark",e._n(t))},expression:"editForm.remark"}})],1)],1),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(){e.editDialogVisible=!1,e.nulltoForm(e.editForm,"editForm")}}},[e._v("取 消")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:function(t){e.submitForm("editForm")}}},[e._v("确 定")])],1)],1)],1)},staticRenderFns:[]};var c=a("VU/8")(s,d,!1,function(e){a("ufzf")},"data-v-5d13442a",null);t.default=c.exports},ufzf:function(e,t){}});
//# sourceMappingURL=29.a521d58a89e272f80238.js.map