<!doctype html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width">
        <title>neo4jd3.js</title>
        <link rel="stylesheet" href="css/bootstrap.min.css">
        <link rel="stylesheet" href="css/font-awesome.min.css">
        <link rel="stylesheet" href="css/neo4jd3.min.css">
        <style>   
            body,
            html,
            .neo4jd3 {
                height: 100%;
                overflow: hidden;
            }
        </style>
    </head>
    <body style="background-color: transparent;">
        <div id="neo4jd3"></div>
        <!-- <a href="https://github.com/eisman/neo4jd3"><img style="cursor: pointer; position: absolute; top: 0; right: 0; border: 0;" src="img/forkme_right_gray_6d6d6d.png" alt="Fork me on GitHub" data-canonical-src="img/forkme_right_gray_6d6d6d.png"></a> -->

        <!-- Scripts -->
        <script src="js/d3.min.js"></script>
		<script src="./qwebchannel.js"></script> 
        <script src="js/neo4jd3.js?v=0.0.1"></script>
        <script type="text/javascript">
		if(typeof qt != "undefined"){
			new QWebChannel(qt.webChannelTransport, function(channel){
				window.Bridge = channel.objects.Bridge;
					Bridge.sigDataChanged.connect(function(dataObj) { //连接Qt中brideg类的信号并定义执行代码
					getData(dataObj)
				});
				Bridge.onInitsized(); //调用Qt内的函数
			});
		}
            // 以上是初始化数据
            let images = {}
            var demoJson = {
                "results": [{
                    "data": [{
                        "graph": {
                            "nodes": [
                            ],
                            "relationships": [
                            ]
                        }
                    }]
                }],
                "errors": []
            }
            function changeData(node) {
                images[node.objId] = node.symbol.split('image://')[1]
                demoJson.results[0]['data'][0]['graph']['nodes'].push({
                    'id': node.id,
                    'labels': [node.objId],
                    "properties": {}
                })
               
                if(node.hasOwnProperty('children')) {
                    node.children.forEach(item => {
                        demoJson.results[0]['data'][0]['graph']['relationships'].push({
                            id: demoJson.results[0]['data'][0]['graph']['relationships'].length + 1,
                            type: item.intimacy,
                            startNode: node.id,
                            endNode: item.id
                         })
                    })
                }
                if (node.hasOwnProperty('children')) {
                    node.children.forEach(function(item, index) {
                        changeData(item);
                    });
                }
            }
            function getData(data) {
                changeData(data)
                init()
            }
            function init() {
                var neo4jd3 = new Neo4jd3('#neo4jd3', {
                    highlight: [
                        {
                            class: 'Project',
                            property: 'objId',
                            value: 'neo4jd3'
                        }
                    ],
                    icons: {
                    },
                    images,
                    minCollision: 50,
                    infoPanel: false,
                    neo4jData: demoJson,
                    nodeRadius: 34,
                    onNodeDragEnd: function(node) {
                        console.log(node)
                    },
                    onNodeDoubleClick: function(node) {
                        console.log(node)
                    },
                    onRelationshipDoubleClick: function(relationship) {
                        console.log('double click on relationship: ' + JSON.stringify(relationship));
                    },
                    zoomFit: true
                });
            }

         
        </script>

        <script>
          (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
          (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
          })(window,document,'script','','ga');

          ga('create', 'UA-430863-29', 'auto');
          ga('send', 'pageview');
        </script>
    </body>
</html>
